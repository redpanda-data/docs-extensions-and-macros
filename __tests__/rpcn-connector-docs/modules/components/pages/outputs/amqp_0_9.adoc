= amqp_0_9
//tag::single-source[]
:type: output
:status: stable
:categories: ["Services"]


// Â© 2024 Redpanda Data Inc.


component_type_dropdown::[]

Sends messages to an AMQP (0.91) exchange. AMQP is a messaging protocol used by various message brokers, including RabbitMQ.


[tabs]
======
Common::
+
--

```yml
# Common configuration fields, showing default values
output:
  label: ""
  amqp_0_9:
    urls: [] # No default (required)
    exchange: "" # No default (required)
    key: "" # Optional
    type: "" # Optional
    metadata:
      exclude_prefixes: []
    max_in_flight: 64
```

--
Advanced::
+
--

```yml
# All configuration fields, showing default values
output:
  label: ""
  amqp_0_9:
    urls: [] # No default (required)
    exchange: "" # No default (required)
    exchange_declare:
      enabled: false
      type: direct
      durable: true
      arguments: {} # No default (optional)
    key: ""
    type: ""
    content_type: application/octet-stream
    content_encoding: "" # Optional
    correlation_id: "" # Optional
    reply_to: "" # Optional
    expiration: "" # Optional
    message_id: "" # Optional
    user_id: "" # Optional
    app_id: "" # Optional
    metadata:
      exclude_prefixes: []
    priority: ""
    max_in_flight: 64
    persistent: false
    mandatory: false
    immediate: false
    timeout: "" # Optional
    tls:
      enabled: false
      skip_cert_verify: false
      enable_renegotiation: false
      root_cas: "" # Optional
      root_cas_file: "" # Optional
      client_certs: []
```

--
======

The metadata fields from each message are delivered as headers.

TLS is automatically enabled when connecting to an `amqps` URL. However, you can customize <<tls, TLS settings>> if required.

You can use xref:configuration:interpolation.adoc#bloblang-queries[function interpolations] to dynamically set values for the following fields: `key`, `exchange`, and `type`.

== Fields

=== `urls`

A list of URLs to connect to. This input attempts to connect to each URL in the list, in order, until a successful connection is established. It then continues to use that URL until the connection is closed.

If an item in the list contains commas, it is split into multiple URLs.

*Type*: `array`

ifndef::env-cloud[]
Requires version 3.58.0 or newer
endif::[]

```yml
# Examples

urls:
  - amqp://guest:guest@127.0.0.1:5672/

urls:
  - amqp://127.0.0.1:5672/,amqp://127.0.0.2:5672/

urls:
  - amqp://127.0.0.1:5672/
  - amqp://127.0.0.2:5672/
```

=== `exchange`

The AMQP exchange to publish messages to. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

*Type*: `string`

=== `exchange_declare`

Passively declares the <<exchange, target exchange>> to check whether an exchange with the specified name exists and is configured correctly. If the exchange exists, then the passive declaration verifies that fields specified in this object match its properties. If the target exchange does not exist, this output creates it.

*Type*: `object`

=== `exchange_declare.enabled`

Whether to enable exchange declaration.

*Type*: `bool`

*Default*: `false`

=== `exchange_declare.type`

The type of the exchange, which determines how messages are routed to queues.

*Type*: `string`

*Default*: `direct`

Options:
`direct`
, `fanout`
, `topic`
, `x-custom`

=== `exchange_declare.durable`

Whether the declared exchange is durable.

*Type*: `bool`

*Default*: `true`

=== `exchange_declare.arguments`

Arguments for server-specific implementations of the exchange (optional). You can use arguments to configure additional parameters for exchange types that require them.

*Type*: `object`

```yml
# Examples

arguments:
  alternate-exchange: my-ae
```

=== `key`

The binding key to set for each message. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `type`

A custom message type to set for each message. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `content_type`

The MIME type of each message. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `application/octet-stream`

=== `content_encoding`

The content encoding attribute of each message. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `correlation_id`

Set a unique correlation ID for each message using a dynamic interpolated expression to help match messages to responses. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `reply_to`

Set the name of the queue to which responses are sent using a dynamic interpolated expression. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `expiration`

Set the TTL of each message in milliseconds. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `message_id`

Set a message ID for each message using a dynamic interpolated expression. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `user_id`

Set the user ID to the name of the publisher. If this property is set by a publisher, its value must match the name of the user that opened the connection. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

=== `app_id`

Set an application ID for each message using a dynamic interpolated expression. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].


*Type*: `string`

*Default*: `""`

=== `metadata`

Specify which (if any) metadata values are added to messages as headers.

*Type*: `object`

=== `metadata.exclude_prefixes`

Provide a list of explicit metadata key prefixes to exclude when adding metadata to sent messages.

*Type*: `array`

*Default*: `[]`

=== `priority`

Set the priority of each message using a dynamic interpolated expression. This field supports xref:configuration:interpolation.adoc#bloblang-queries[interpolation functions].

*Type*: `string`

*Default*: `""`

```yml
# Examples

priority: "0"

priority: ${! meta("amqp_priority") }

priority: ${! json("doc.priority") }
```

=== `max_in_flight`

The maximum number of messages to have in flight at a given time. Increase this number to improve throughput.

*Type*: `int`

*Default*: `64`

=== `persistent`

Whether to store delivered messages on disk. By default, message delivery is transient.

*Type*: `bool`

*Default*: `false`

=== `mandatory`

Whether to set the mandatory flag on published messages. When set to `true`, a published message that cannot be routed to any queues is returned to the sender.

*Type*: `bool`

*Default*: `false`

=== `immediate`

Whether to set the immediate flag on published messages. When set to `true`, if there are no active consumers for a queue, the message is dropped instead of waiting.

*Type*: `bool`

*Default*: `false`

=== `timeout`

The maximum period to wait for a message acknowledgment before abandoning it and attempting a resend. If this value is not set, the system waits indefinitely.

*Type*: `string`

*Default*: `""`

=== `tls`

Override system defaults with custom TLS settings.


*Type*: `object`


=== `tls.enabled`

Whether custom TLS settings are enabled.


*Type*: `bool`

*Default*: `false`

=== `tls.skip_cert_verify`

Whether to skip server-side certificate verification.


*Type*: `bool`

*Default*: `false`

=== `tls.enable_renegotiation`

Whether to allow the remote server to repeatedly request renegotiation. Enable this option if you're seeing the error message `local error: tls: no renegotiation`.


*Type*: `bool`

*Default*: `false`

ifndef::env-cloud[]
Requires version 3.45.0 or newer
endif::[]

=== `tls.root_cas`

Specify a certificate authority to use (optional). This is a string that represents a certificate chain from the parent-trusted root certificate, through possible intermediate signing certificates, to the host certificate.

include::components:partial$secret_warning.adoc[]

*Type*: `string`

*Default*: `""`

```yml
# Examples

root_cas: |-
  -----BEGIN CERTIFICATE-----
  ...
  -----END CERTIFICATE-----
```

=== `tls.root_cas_file`

Specify the path to a root certificate authority file (optional). This is a file, often with a `.pem` extension, that contains a certificate chain from the parent-trusted root certificate, through possible intermediate signing certificates, to the host certificate.

*Type*: `string`

*Default*: `""`

```yml
# Examples

root_cas_file: ./root_cas.pem
```

=== `tls.client_certs`

A list of client certificates to use. For each certificate, specify values for either the `cert` and `key` fields, or the `cert_file` and `key_file` fields.

*Type*: `array`

*Default*: `[]`

```yml
# Examples

client_certs:
  - cert: foo
    key: bar

client_certs:
  - cert_file: ./example.pem
    key_file: ./example.key
```

=== `tls.client_certs[].cert`

A plain text certificate to use.

*Type*: `string`

*Default*: `""`

=== `tls.client_certs[].key`

A plain text certificate key to use.

include::components:partial$secret_warning.adoc[]

*Type*: `string`

*Default*: `""`

=== `tls.client_certs[].cert_file`

The path of a certificate to use.

*Type*: `string`

*Default*: `""`

=== `tls.client_certs[].key_file`

The path of a certificate key to use.

*Type*: `string`

*Default*: `""`

=== `tls.client_certs[].password`

A plain text password for when the private key is password encrypted in PKCS#1 or PKCS#8 format. The obsolete `pbeWithMD5AndDES-CBC` algorithm is not supported for the PKCS#8 format.

WARNING: The `pbeWithMD5AndDES-CBC` algorithm does not authenticate ciphertext, and is vulnerable to padding oracle attacks, which may allow an attacker to recover the plain text password.

include::components:partial$secret_warning.adoc[]

*Type*: `string`

*Default*: `""`

```yml
# Examples

password: foo

password: ${KEY_PASSWORD}
```

// end::single-source[]