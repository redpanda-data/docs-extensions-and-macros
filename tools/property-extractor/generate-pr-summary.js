#!/usr/bin/env node

/**
 * Standalone CLI tool to generate PR summaries from property diff JSON files
 *
 * Usage:
 *   node generate-pr-summary.js <diff-json-file>
 *
 * Example:
 *   node generate-pr-summary.js ../../docs-data/redpanda-property-changes-v25.3.1-to-v25.3.3.json
 */

const fs = require('fs');
const path = require('path');
const { printPRSummary } = require('./pr-summary-formatter');

// CLI usage
if (require.main === module) {
  const args = process.argv.slice(2);

  if (args.length < 1) {
    console.error('Usage: node generate-pr-summary.js <diff-json-file>');
    console.error('');
    console.error('Example:');
    console.error('  node generate-pr-summary.js redpanda-property-changes-v25.3.1-to-v25.3.3.json');
    console.error('');
    console.error('This tool reads a property diff JSON file (generated by compare-properties.js)');
    console.error('and outputs a GitHub PR-ready markdown summary.');
    process.exit(1);
  }

  const diffFilePath = path.resolve(args[0]);

  if (!fs.existsSync(diffFilePath)) {
    console.error(`Error: Error: File not found: ${diffFilePath}`);
    process.exit(1);
  }

  try {
    const diffData = JSON.parse(fs.readFileSync(diffFilePath, 'utf8'));
    printPRSummary(diffData);
  } catch (error) {
    console.error(`Error: Error reading diff file: ${error.message}`);
    process.exit(1);
  }
}
